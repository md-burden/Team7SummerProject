<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Recipe Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>


    <!-- Using thymeleaf to load style sheet -->
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}">

</head>


<body style="background:#FAF4DF">

<!-- Begin Nav Bar -->
<div style="display: flex; flex-direction:column; justify-content:flex-start; align-items: center;">

    <div class="container-fluid" ID="Banner">

        <a class="btn" id="HomeButton" data-th-href="@{/CREATOR/home}">
            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" style="display: inline;" class="bi bi-house"
                 viewBox="0 0 16 16">
                <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
            </svg>
        </a>


        <h1 style="color:#FAF4DF; font-size:32pt; font-family:Tahoma; display: inline;" id="TitleText">Recipeasy</h1>

        <a data-th-href="@{/CREATOR/create}">
            <button class="btn" id="NewRecipeButton">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-circle-plus"
                     viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
                </svg>
            </button>
        </a>

        <a data-th-href="@{/CREATOR/all}">
            <button class="btn" id="FavoritesButton">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-archive-fill"
                     viewBox="0 0 16 16">
                    <path d="M12.643 15C13.979 15 15 13.845 15 12.5V5H1v7.5C1 13.845 2.021 15 3.357 15zM5.5 7h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1M.8 1a.8.8 0 0 0-.8.8V3a.8.8 0 0 0 .8.8h14.4A.8.8 0 0 0 16 3V1.8a.8.8 0 0 0-.8-.8z"/>
                </svg>
            </button>
        </a>

        <a data-th-href="@{/user/{userId} (userId=${userId})}">
            <button class="btn" id="UserIcon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-person-circle"
                     viewBox="0 0 16 16">
                    <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                    <path fill-rule="evenodd"
                          d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
                </svg>
            </button>
        </a>

    </div>
</div>
<!--End Banner -->


<div th:object="${recipe}">
    <div style="margin:20px;">
        <div style="display:flex; flex-direction: row; justify-content: flex-start; gap: 20px;">

            <!---Recipe Image--->
            <img th:src="*{recipeImage}" alt="" id="RecipePhoto">
            <div class="container-fluid">
                <div class="row justify-content-between">
                    <!---Title--->
                    <div class="col-4">
                        <h2>
                            <p data-th-text="${recipe.recipeTitle}"></p>
                        </h2>
                        <div class="row">
                            <div class="col">
                                <!---Country of Origin--->
                                <p style="font-size:16pt" data-th-text="${recipe.recipeCountry}"></p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <div class="col">
                                    <!---Category--->
                                    <p style="font-size:16pt" data-th-text="${recipe.recipeType}"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-2" style="padding: 0">
                        <a data-th-href="@{/recipe/CREATOR/update?userId={userId}&recipeId={recipeId} (recipeId=${recipe.recipeId}, userId=${recipe.user.userId})}">
                            <button class="btn btn-primary">Edit Recipe</button>
                        </a>
                    </div>
                </div>
            </div>

        </div>

    </div>

    <div style="margin: 0 10px 0 10px;">
        <div class="row">
            <!-- Recipe Ingredients List -->
            <div class="col-4">
                <h3>Ingredients</h3>
                <div style="display:flex; flex-direction: row; justify-content: flex-start;"
                     th:each="ingredient : ${recipe.ingredients}">
                    <div style="">
                        <div class="form-check">
                            <div style="display:flex; flex-direction: row; justify-content: flex-start; gap:5px;">
                                <label>
                                    <input class="form-check-input" type="checkbox" style="margin:5px 0 0 0">
                                </label>
                                <p class="IngredientList" th:text="${ingredient.ingredientName}"></p>
                                <p class="IngredientList" th:text="${ingredient.ingredientAmount}"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recipe Instructions -->
            <div class="col-8">
                <h3>Instructions</h3>
                <p data-th-text="${recipe.recipeInstructions}"></p>
            </div>

        </div>
    </div>

    <!-- Comments -->
    <div style="margin:20px; min-height:50px;">
        <h3>Questions & Comments</h3>
    </div>
    <div class="col" th:each="comment : ${comments}">
        <div style="margin:20px;" th:if="${comment.commenter.userId != recipe.user.userId}">
            <div class="card" style="width: 45rem;">
                <div class="card-body">
                    <h5 class="card-title" th:text="${comment.commenter.getEmail()}"></h5>
                    <p class="card-text" th:text="${comment.commentContents}"></p>
                    <div class="row justify-content-md-end">
                        <div class="col-md-auto">
                            <!-- Modal -->
                            <div class="modal fade"
                                 id="replyModal"
                                 tabindex="-1"
                                 aria-labelledby="exampleModalLabel"
                                 aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title"
                                                id="exampleModalLabel">
                                                Replying to <p th:text="${comment.commenter.getEmail()}"
                                                               style="float: right; margin-left: 10px;"></p>
                                            </h5>
                                            <button type="button"
                                                    class="btn-close"
                                                    data-bs-dismiss="modal"
                                                    aria-label="Close">

                                            </button>
                                        </div>

                                        <div class="modal-body">
                                            <form action="#" th:action="@{/CREATOR/reply}" th:object="${comment}"
                                                  method="post">

                                                <textarea class="form-control" id="reply" name="commentContents"
                                                          th:data="*{commentContents}"
                                                          placeholder="Write your reply..."
                                                          rows="5"></textarea>
                                                <input type="hidden" th:value="${recipe.recipeId}" name="recipe">
                                                <input type="hidden" th:value="${recipe.user.userId}" name="commenter">
                                                <input type="hidden" th:value="${comment.commentId}" name="connectedId">
                                                <div class="modal-footer">
                                                    <button type="button"
                                                            class="btn btn-secondary"
                                                            data-bs-dismiss="modal">
                                                        Close
                                                    </button>
                                                    <button type="submit"
                                                            class="btn btn-primary">
                                                        Save
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-auto">


                        <!-- Modal -->
                        <div class="modal fade"
                             id="reportModal"
                             tabindex="-1"
                             aria-labelledby="exampleModalLabel"
                             aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title"
                                            id="reportTitle">
                                            Reporting <p th:text="${comment.commenter.getEmail()}"
                                                         style="float: right; margin-left: 10px;"></p>
                                        </h5>

                                        <form action="" th:object="${report}">
                                            <input type="hidden" th:value="${comment}" name="comment">
                                            <textarea class="form-control" id="report" name="commentContents"
                                                      th:field="*{}"
                                                      placeholder="Write your reply..."
                                                      rows="5"></textarea>
                                        </form>
                                        <button type="button"
                                                class="btn-close"
                                                data-bs-dismiss="modal"
                                                aria-label="Close">

                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <form action="">
                                                <textarea class="form-control" id="recipeInstructions"
                                                          name="recipeInstructions"

                                                          placeholder="Write your reply..."
                                                          rows="5"></textarea>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button"
                                                class="btn btn-secondary"
                                                data-bs-dismiss="modal">
                                            Close
                                        </button>
                                        <button type="submit"
                                                class="btn btn-primary">
                                            Save
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>



                    </div>
                </div>

                <!-- Card Buttons -->

                <div class="row justify-content-end" style="margin: 10px;">

                    <!-- Reply Button -->
                    <div class="col-md-auto">
                        <button type="button"
                                class="btn btn-primary btn-small"
                                data-bs-toggle="modal"
                                data-bs-target="#replyModal">
                            Reply
                        </button>
                    </div>

                    <!-- Report Button -->
                    <div class="col-md-auto">
                        <button type="button"
                                class="btn btn-danger btn-small"
                                data-bs-toggle="modal"
                                data-bs-target="#reportModal">
                            Report
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div th:each="reply : ${comments}">
            <div th:if="${reply.connectedId == comment.commentId}">
                <div class="card" style="width: 45rem; margin-left: 75px; margin-bottom: 50px">
                    <div class="card-body">
                        <h5 class="card-title" th:text="${reply.commenter.getEmail()}"></h5>
                        <p class="card-text" th:text="${reply.commentContents}"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>